# 数据库设计
## 数据库设计概述
- 数据库设计
	- 数据库设计是指对于一个给定的应用环境，构造(设计)优化的数据库**逻辑模式**和**物理结构**，**并据此建立数据库及应用系统**，使之能够有效的存储和管理数据，满足各种用户的应用需求，包括信息管理要求和数据操作要求
	- 信息管理要求：在数据库中应该存储和管路哪些数据对象
	- 数据操作要求：对数据对象需要进行那些操作，如查询，增，删，改，统计等操作
	- 数据库设计的目标是为用户和各种应该用系统提供一个**信息基础设施**和高效率的**运行环境**
	- 数据库设计特点
		- 三分技术，七分管理，十二分基础数据
		- 管理
			- 数据库建设项目管理
			- 企业的业务管理
		- 基础数据
			- 数据的收集，整理，组织和不断更新
		- 结构设计和行为设计相结合
	- 数据库设计方法
		- 手工试凑法
		- 规范设计法
	- 数据库设计的基本步骤
		- 数据库设计分6个阶段
			- 需求分析
				- 是否做的充分与准确决定了构建数据库的速度和质量
				- 需求分析和概念设计独立于任何数据库管理系统，逻辑设计和物理设计与选用的数据库管理系统密切相关
			- 概念结构设计
				- 通过对用户需求进行综合，归纳与抽象，形成一个独立于具体数据库管理系统的概念模型
			- 逻辑结构设计
				- 将概念结构转换为某个数据库管理系统所支持的数据模型，并对其进行优化
			- 物理结构设计
				- 为逻辑数据结构选取一个最适合应用环境的物理结构
				- 包括存储结构和存取方法
			- 数据库实施
				- 根据逻辑设计和物理设计的结果构建数据库
				- 编写与调试应用程序
				- 组织数据入库并进行试运行
			- 数据库运行和维护
				- 经试运行后即可投入正式运行
				- 在运行过程中必须不断对其进行评估，调整与修改
		- 设计一个完善的数据库往往是上述六个阶段的不断反复
	- 数据库设计中的各级模式
		- 需求分析阶段：综合各个用户的应用需求
		- 概念设计阶段：形成独立于机器特点，独立于各个数据库管理系统产品的**概念模式**(E-R图)
		- 逻辑设计阶段
			- 首先将E-R图转换成具体的数据库产品支持的数据模型，如关系模型，形成数据库**逻辑模式**
			- 然后根据用户处理的要求，安全性的考虑，在进本表的基础上在建立必要的视图，形成数据的**外模式**
		- 物理设计阶段
			- 根据数据库管理系统特点和处理的需要，进行物理存储安排，建立索引，形成数据库**内模式**
## 需求分析
- 需求分析的任务	
	- 需求分析就是分析用户的要求
		- 式设计数据库的起点
		- 接管是否准确反映了用户的实际要求，将直接影响到后面各个阶段的设计，并影响到设计结果是否合理和实用
	- 详细调查现实世界要处理的对象(组织，部门，企业等)
	- 充分了解原系统工作概况
	- 明确用户的各种需求
	- 在此基础上确定新系统的功能
	- 新系统必须充分考虑今后可能的扩充和改变
	- 调查的重点是‘数据’和‘处理’，获得用户对数据库的要求
		- 信息要求
			- 用户需要从数据库中获得信息的内容与性质
			- 由信息要求可以到处数据要求，即在数据库中需要存储那些数据
		- 处理要求
			- 用户要完成的功能
			- 对处理性能的要求
		- 安全性与完整性要求
	- 确定用户最终需求的难点
		- 用户缺少计算机知识，不能准确表达自己的需求额，他们所提出的需求往往不断地变化
		- 设计人员缺少用户的专业知识，不易理解用户的真正需求，甚至误解用户的需求
		- 解决方法：设计人员必须不断深入地与用户有进行交流，才能逐步确定用户的实际需求
- 需求分析的方法
	- 调查清楚用户的实际需求并进行初步分析
		- 调查组织机构情况
		- 调查各部门的业务活动情况
		- 协助用户明确对新系统的各种要求，包括信息要求，处理要求，完全性和完整性要求
		- 确定新系统的边界
	- 与用户达成共识
		- 对用户的需求进行分析与表达后，需求分析报告必须提交给用户，征得用户的认可
	- 分析与表达这些需求
- 数据字典
	- 数据字典的内容
		- 数据项	
			- **最小组成单位**
			- 若干个数据项可以组成一个数据结构
		- 数据结构
		- 数据流
		- 数据存储
		- 处理过程
	- 数据字典通过对数据项和数据结构的定义来描述数据流，数据存储的逻辑内容
	- 数据项
		- 不可再分的数据单位
		- **数据项描述 = {数据项名，数据项含义说明，别名，数据类型，长度，取值范围，取值含义，与其他数据项的逻辑关系，数据项之间的联系}**
	- 数据结构
		- 数据结构反映了数据之间的组合关系
		- 一个数据结构可以由若干个数据项组成，也可以由若干个数据结构组成，或混合组成
		- **数据结构描述 = {数据结构名，含义说明，组成：{数据项或数据结构}}**
	- 数据流
		- 数据流是数据结构在系统内传输的路径
		- **数据流描述 = {数据流名，说明，数据流来源，数据流去向，组成：{数据结构}，平均流量，高峰期流量}**
	- 数据存储
		- 数据存储是数据结构停留或保存的地方，也是数据流的来源和去向之一
		- **数据存储描述 = {数据存储名，说明，编号，输入的数据流，输出的数据流，组成：{数据结构}，数据量，存取频度，存取方式}**
	- 处理过程
		- 处理过程具体处理逻辑一般用判定表或判定树来描述。数据字典中只需要描述处理过程的说明性信息。
## 概念结构设计（**概念模式**）
- 概念模型
	- 将需求分析得到的用户需求抽象为信息结构的过程就是概念结构设计
	- 概念模型的特点
		- 能真实，充分的反映现实世界，是现实世界的一个真实模型
		- 易于理解，从而可以用他和不熟悉计算机的用户交谈
		- 易于更改，当应用环境和应用要求改变时，容易用概念模型修改和扩充
		- 易于像关系，网状，层次等各种数据模型转换
	- 工具：E-R模型
- E-R模型
	- 实体之间的联系
		- 一对一
		- 一对多
		- 多对多
	- 方法
		- 实体型：用矩形表示，框内写明实体名
		- 属性：用椭圆表示，并用无向边将其与相应的实体型连接起来
		- 联系：用菱形表示，框内写明联系名，并用无向边分别与有关实体型连接起来，同时在无向边旁标上联系的类型。联系可以具有属性。
- 概念结构设计
	- 为了简化E-R图的处置，现实世界的事务能作为属性对待的，尽量作为属性对待
	- 两条准则：
		- 作为属性，不能在具有需要描述的性质。属性不许是不可分的数据项，不能包含其他属性
		- 属性不能与其他实体具有联系，即E-R图中所表示的联系是实体之间的联系
	- E-R图的集成
		- 合并E-R图，生成初步E-R图
			- 各个局部应用面向的问题不同，各个子系统的E-R图之间必定会存在许多不一致的地方，称之为冲突
		- 子系统E-R图之间的冲突主要有三类
			- **属性冲突**
				- 属性域冲突，即属性值的类型，取值范围，获取值集合不同
				- 属性取值单位冲突
			- **命名冲突**
				- 同名异议
				- 异名同义
				- 可能发尚在实体，联系一级上，也可能发生在属性上
			- **结构冲突**
				- 同一对象在不同应用中具有不同的抽象
					- 例如：职工在某一局部应用被当作实体，在另一局部应用则被当作属性
					- 解决方法：把属性变换为实体，或把实体变换为属性，使同一对象具有相同的抽象
				- 同一实体在不同子系统的E-R图中所包含的属性个数和属性排列次序不完全相同
					- 解决方法：使该实体的属性取各子系统的E-R图中属性的并集，在适当调整顺序
				- 实体间的联系在不同的E-R图中为不同的类型
					- 解决方法：根据语义调整

## 逻辑结构设计（**逻辑模式，外模式**）
- 把概念结构设计阶段设计好的基本E-R图转换为与选用数据库管理系统产品所支持的数据模型相符合的逻辑结构
- E-R图向关系模型的转化
	- 转换内容
		- E-R图由实体型，实体的属性，和实体型之间的联系三要素组成
		- 关系模型的逻辑结构是一组关系模式的集合
		- 将E-R图转换为关系模型：将实体型，实体的属性，和实体之间的联系转化为关系模式
	- 转换原则
		- 关系的属性：实体的属性
		- 关系的码：实体的码
	- 实体型间的联系有以下不同情况
		- 一个一对一联系可以转换为一个独立的关系模式，也可以与任意一段对应的关系模式合并
		- 一对多联系可以转换为一个独立的关系模式，也可以与n端对应的关系模式合并
		- 多对多联系转换成为一个关系模式
		- 三个或三个以上实体间的一个多元联系转换为一个关系模式
		- 具有相同码的关系模式可合并
- 数据模型的优化
	- 一般的数据模型还需要向特定的数据库管理系统规定的模型进行转换，转换的主要依据是所选用的数据库管理系统的功能及限制，没有通用规则。
	- 数据库逻辑设计的结果不是唯一的
	- 得到初步数据模型后，还应该适当地修改，调整数据模型的结构，以进一步提高数据库应用系统的性能，这就是数据模型的优化
	- 方法
		- 确定数据依赖
			- 按需求分析阶段所得到的语义，分别写出每个关系模式内部各属性之间的数据依赖，以及不同关系模式属性之间的数据依赖
		- 对于各个关系模式之间的数据依赖进行极小化处理，消除冗余的联系
		- 按照数据依赖的理论对关系模式进行分析，考察是否存在部分函数依赖，传递以来，多值依赖等，确定各关系模式分别属于第几范式
		- 按照需求分析街富安得到的各种应对数据处理的要求，分析对于这样的应用环境只写模式是否合适，确定是否要对他们进行合并或分解
		- 对关系模式进行必要的分解，提高数据操作效率和存储空间的利用率
			- 水平分解：把关系的元组分为若干个子集合
			- 垂直分解：把关系模式的属性分解为若干个子集合
- 设计用户子模式
	- 定义数据库主要是从系统的时间效率，空间效率，易维护等角度除法
	- 定义用户外模式时应该更注重考虑用户的习惯于方便，包括三个方面
		- 使用更符合用户习惯的别名
		- 针对不同级别的用户定义不同的视图，以保证系统的安全性
		- 简化用户对系统的使用
## 物理结构设计（**内模式**）
- 概念
	- 数据库在物理设备上的存储结构与存取方法称为数据库的物理结构，它依赖于选定的数据库管理系统
	- 为一个给定的逻辑数据模型选取一个最适合引用要求的物理结构的过程，就是数据库的物理设计
	- 步骤
		- 确定数据库的物理结构
		- 对物理结构进行评价
		- 若评价结果满足原设计要求，则可以进入物理实施阶段，否则就要重新设计或修改物理结构
- 数据库物理设计的内容和方法
	- 准备工作
		- 充分了解应用环境，详细分析要运行的事务，以获得选择物理数据库设计所需参数
		- 充分了解所用关系西数据库管理系统的内部特征，特别是系统提供的存取方法和存取结构
	- 选择物理数据库设计所需参数
		- 数据库查询事务
		- 数据库更新事务
		- 每个事务在各关系上运行的频率和性能要求
	- 关系数据库物理设计的内容
		- 为关系模式选区存取方法(建立存取路径)
		- 设计关系，索引等数据文件的物理存储结构
- 关系模式存取方法和选择
	- 数据库系统是多用户共享的系统，对统一各关系要建立多条存取路径才能满足多用户的多种应用要求
	- 物理结构设计的任务之一是根据关系数据库管理系统支持的存取方法确定选择哪些存取方法
	- 数据库管理系统常用的存取方法
		- B+树索引存取方法
			- 选择索引存取方法的一般规则
				- 如果一个或一组属性经常在查询条件中出现，则考虑在这个属性（组）上建立索引
				- 如果一个属性经常作为最大值和最小值等聚集函数的参数，则考虑在这个属性上建立索引
				- 如果一个属性经常在连接操作的连接条件中出现，则考虑在这个属性上建立索引
		- Hash索引存取方法
			- 如果一个关系的属性主要出现在等值连接条件中，或主要出现在等值比较选择条件中，而且满足以下两个条件之一
				- 该关系的大小可预知，而且不变
				- 该关系的大小动态改变，但所选用的数据库管理系统提供了动态Hash存取方法
		- 聚簇存取方法
			- 为了提高某个属性的查询速度，把这个或这些属性上具有相同值的元组集中存放在连续的物理块中称为聚簇，该属性称为聚簇码
			- 适用条件
				- 很少对基本表进行增删操作
				- 很少对其中的边长列进行修改操作
			- 用途
				- 大大提高按聚簇属性进行查询的效率
				- 节省存储空间
			- 局限性
				- 只能提高某些特定应用的性能
				- 建立与维护聚簇的开销相当大
- 确定数据库的存储结构
	- 确定数据库物理存储结构主要指确定数据的**存放位置**和**存储结构**，包括确定关系，索引，聚簇，入职，备份等的存储安排和村是结构
	- 确定数据的存放位置和存储结构要综合考虑**存取时间，存储空间利用率，维护代价**三个方面的因素
	- 这三个方面是矛盾的，要选择一个折中的方案
	- 确定数据的存放位置
		- 易变部分与稳定部分分开存放
		- 经常存取部分与存取频率低的部分分开存放
	- 确定系统配置
- 评价物理结构
	- 对数据库物理设计过程中产生的多种方案进行评价，从中选择一个交友的方案作为数据库的物理结构
	- 评价方法
		- 定量估算各种方案
			- 存储空间
			- 存取时间
			- 维护代价
## 数据库的实施和维护
- 数据载入
	- 人工方法
	- 计算机辅助数据入库
- 数据库试运行
	- 功能测试
	- 性能测试
- 数据库的运行和维护
	- 数据库的转储和恢复
	- 数据库的安全性和完整性控制
	- 数据库性能的监督和改进数据库的重组织和重构造
## 小结
- 在逻辑设计阶段将E-R图转换成具体的数据库产品支持的数据模型如关系模型，形成数据库**逻辑模式**
- 然后根据用户处理的要求，安全性的考虑，在基本表的基础上再建立必要的视图，形成数据的**外模式**
- 在物理设计阶段根据DBMS特点和处理的需要，进行物理存储安排，设计索引，形成数据库**内模式**