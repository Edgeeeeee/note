# 第三章 数据链路层
- 数据链路层使用的信道主要有以下几种类型：
	- **点对点信道**：这种信道使用**一对一的点对点通信方式**
	- **广播信道**：这种信道使用**一对多的广播通信**方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送
	- ![VK44F1.png](https://s2.ax1x.com/2019/05/30/VK44F1.png)
### 使用点对点信道的数据链路层
##### 数据链路和帧
- **链路**是一条无源的点到点的物理线路段，中间没有任何其他的交换结点。**一条链路只是一条通路的一个组成部分。**
- **数据链路**除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路
	- 现在最常用的方法是使用适配器（即网卡）来实现这些协议的硬件和软件
	- 一般的适配器都包括了数据链路层和物理层这两层的功能
- 也有人采用另外的术语，把链路分为物理链路和逻辑链路
	- **物理链路**就是上面的链路
	- **逻辑链路**就是上面的数据链路，是物理链路加上必要的协议。
	- 早期的数据通信协议曾叫做**通信规程**，因此在数据链路层，规程和协议是同意语
- 数据链路层像个数字管道
	- 数据链路层传送的是帧
	- 常常在两个对等的数据链路层之间画出一个数字管道，而在这条数字管道上传输的数据单位是帧
	- 数据链路层不必考虑物理层如何实现比特传输的细节。甚至还可以更简单地设想好像是沿着两个数据链路层之间的水平方向把帧直接放送到对方。
	- ![VQD0G4.png](https://s2.ax1x.com/2019/05/31/VQD0G4.png)
##### 三个基本问题
- 数据链路层协议有许多种，但有三个基本问题是共同的
	- **封装成帧**
	- **透明传输**
	- **差错控制**
- 封装成帧
	- **封装成帧**就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。确定帧的界限。
	- 首部和尾部的一个重要作用就是进行**帧定界**。
	- ![VQDfiD.png](https://s2.ax1x.com/2019/05/31/VQDfiD.png)
	- 用**控制字符**进行帧定界的方法举例
		- 当数据是由可打印的ASCII码组成的文本文件时，帧定界可以使用特殊的帧定界符。
		- 控制字符SOH（start of header）放在一帧的最前面，表示帧首部的开始。另一个控制字符EOT（end of transmission）表示帧的结束。
		- ![VQrEYF.png](https://s2.ax1x.com/2019/05/31/VQrEYF.png)
- 透明传输
	- 如果书籍中的某个字节的二进制代码恰好和SOH或者EOT一样，数据链路层就会错误的找到帧的边界。
	- ![VQreSJ.png](https://s2.ax1x.com/2019/05/31/VQreSJ.png)
	- 解决方法：**字节填充**（或**字符填充**）
	- 发送端的数据链路层在数据中出现控制字符SOH或EOT的前面**插入一个转义字符ESC**(其16进制编码时1B)
	- 接收端的数据链路层在将数据送往网络层之前，删除插入的转义字符。
	- 如果转义字符也出现在数据中，那么应在转义字符前面插入一个转义字符ESC。当接收端受到连续的两个转义字符时，就删除前面的一个。
	- ![VQrDk8.png](https://s2.ax1x.com/2019/05/31/VQrDk8.png)
- 差错检测
	- 在传输过程中可能会产生**比特差错**：1可能会变成0，0可能变成1
	- 在一段时间内，传输错误的比特占所传输比特总数的比率称为**误码率**BER
	- 误码率和信噪比有很大的关系
	- 为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。
- 循环冗余检验的原理
	- 在数据链路层传送的帧中，广泛使用了**循环冗余检验CRC**的检错技术
	- 在发送端，先把数据划分为组。假定每组k个比特
	- 假设待传送的一组数据M = 101001（现在k = 6）。我们在M的后面再添加供差错检测用的n为**冗余码**一起发送。
	- 冗余码的计算
		- 用二进制模2运算进行2的n次方乘M的运算，这相当于在M后面添加n个0。
		- 得到的（k+n）位的数除以事先选定好的长度为（n+1）位的**除数**P，得出**商**是Q而**余数**是R，余数R比数除P少一位，即R是n位。
		- 将余数R作为冗余码拼接在数据M后面发送出去。
		- 举例
		- ![VQsUCF.png](https://s2.ax1x.com/2019/05/31/VQsUCF.png)
		- 循环冗余检验的原理说明
		- ![VQsrHx.png](https://s2.ax1x.com/2019/05/31/VQsrHx.png)
- 帧检验序列FCS
	- 在数据后面天机上冗余码称为**帧检验序列FCS**
	- 循环同于检验CRC和帧检验序列FCS并不等同。
		- CRC是一种常用的检错方法，而FCS是添加在数据后面的冗余码
		- FCS可以用CRC这种方法得出，但CRC并非用来获得FCS的唯一方法
- 接收端对收到的每一帧进行CRC检验
	- 若得出的余数R = 0，则判定这个帧没有差错，就**接受**
	- 若余数R不为0，则判定这个帧有差错，就丢弃。
	- 但这种检测方法并不能确定究竟是哪一个，或哪几个比特出现了差错。
	- 只要经过严格的挑选，并使用位数足够多的除数P，那么出现检测不到的差错的概率就很小。
- 注意：
	- 仅用循环冗余检验CRC差错检测技术只能做到**无差错接受**。
	- **无差错接受**是指：凡是接受的帧（即不包括丢弃的帧），我们都能以非常接近于1的概率认为这些帧在传输过程中没有产生差错。
	- 也就是说：凡是接受端数据链路层接受的帧都没有传输差错
	- **要做到“可靠传输”（即发送什么就受到什么）就必须再加上确认和重传机制。**
	- **“无比特差错”与“无传输差错”是不同的概念**
	- **在数据链路层使用CRC检验，能够实现无比特差错的传输，但这还不是可靠传输**
	- 本章介绍的数据链路层协议都不是可靠传输的协议
### 点对点协议PPP
##### PPP协议的特点
- 对于点对点的链路，目前使用最广泛的数据链路层协议是**点对点协议PPP**
- 用户使用拨号电话线接入互联网时，用户计算机和ISP进行通信时所使用的数据链路层协议就是PPP协议
- ![VQcABR.png](https://s2.ax1x.com/2019/05/31/VQcABR.png)
- PPP协议应满足的要求
	- 简单：这是首要的要求
	- 封装成帧：必须规定特殊额字符作为帧定界符
	- 透明性：必须保证帧的透明性。
	- 多种网络层协议：能够在同一条芦屋链路上同时支持多种网络层协议。
	- 多种类型链路：能够在多种类型的链路上运行。
	- 差错检测：能够对接收端收到的帧进行检测，并立即丢弃有差错的帧。
	- 检测连接状态：能够及时自动检测处链路是否处于贞昌工作状态
	- 最大传送单元：必须对每一种类型的点对点链路设置最大传送单元MTU的标准默认值，促进各种实现之间的互操作性。
	- 网络层地址协商：必须提供一种机制使通信的两个网络层实体能够通过协商知道或能够配置彼此的网络层地址。
	- 数据压缩协商：必须提供一种方法来协商使用数据压缩算法。
- PPP协议不需要的功能
	- 纠错
	- 流量控制
	- 序号
	- 多点线路
	- 半双工或单工链路
- PPP协议的组成：三个部分
	- 一个将IP数据包封装到串行链路的方法。
	- 链路控制协议LCP
	- 网络控制协议 NCP
##### PPP协议的帧格式
- PPP帧的首部和尾部分别为4个字段和2个字段。
- 标志字段F = 0x7E（01111110）
- 地址段A只设置为0xFF。地址字段实际上并不起作用
- 控制字段C通常置为0x03.
- **PPP是面向字节的，所有的PPP帧的长度都是整数字节**
- ![VlpxyD.png](https://s2.ax1x.com/2019/05/31/VlpxyD.png)
- PPP有一个2字节的协议字段。其值
	- 若为0x0021，则信息字段就是IP数据报
	- 若为0x8021，则信息字段就是网络控制数据
	- 若为0xC021，则信息字段是PPP链路控制数据
	- 若为0xC023，则信息字段是鉴别数据
- 透明传输问题
	- 当PPP用在同步传输链路时，协议规定采用硬件来完成**比特填充**。
	- 当PPP用在异步传输时，就使用一种特殊的**字符填充法**
- 字符填充
	- 将信息字段中出现的每一个0x7E字节转变成为2字节序列（0x7D，0x5E).
	- 若信息字段中出现一个0x7D的字节，则将其转变成为2字节序列（0x7D，0x5D）。
	- 若信息字段中出现ASCII码的控制字符，即数值小于0x20的字符，则在该字符前面要加入一个0x7D字节，同时将该字符的编码加以改变。
- 零比特填充
	- **PPP协议用在SONET/SDH链路时，使用同步传输（一连串的比特连续传送）。这时PPP协议采用零比特填充方法来实现透明传输。**
	- 再发送端，只要发现有5个连续1，则立即填入一个0。
	- 接收端对帧中的比特流进行扫描。每当发现5个连续的1时，就把这5个连续1后的一个0删除。
	- ![Vl5iVg.png](https://s2.ax1x.com/2019/05/31/Vl5iVg.png)
- PPP协议之所以不使用序号和确认机制是出于以下的考虑
	- **在数据链路层出现差错的概率不大时，使用比较简单的PPP协议较为合理**。
	- **在因特网环境下，PPP的信息字段放入的数据是IP数据报，数据链路层的可靠传输并不能够保证网络层的传输也是可靠的。**
	- **帧检验序列FCS字段可保证无差错接受。**
##### PPP协议的工作状态
- 当用户拨号接入ISP时，路由器的调制解调器对拨号做出确认，并建立一条物理连接。
- PC机向路由器发送一系列的LCP分组（封装成多个PPP帧）。
- 这些分组及其响应选择一些PPP参数，并进行网络层配置，NCP给新介入的PC机分配一个临时的IP地址，使PC机成为因特网上的一个主机。
- 通信完毕时，NCP释放网络成连接，收回原来分配出去的IP地址。接着，LCP释放数据链路层连接，最后释放的是物理层的连接。
- **可见，PPP协议已不是纯粹的数据链路层的协议，它还包含了物理层和网络层的内容。**
### 使用广播信道的数据链路层
##### 局域网的数据链路层
- 局域网最初要的**特点**是：
	- 网络为一个单位所有
	- 地理范围和站点数目均有限
- 局域网具有如下**主要优点**
	- 具有广播功能，从一个站点可很方便地访问全网。局域网上的主机可共享连接在局域网上的各种硬件和软件资源。
	- 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。
	- 提高系统的可靠性，可用性和残存性。
- 媒体共享技术
	- 静态划分信道
		- 频分复用
		- 时分复用
		- 波分复用
		- 码分复用
	- 动态媒体接入控制（多点接入）
		- 随机接入
		- 受控接入
- 以太网的两个标准
	- **DIX Ethernet V2** 是世界上第一个局域网产品（以太网）的规约。
	- **IEEE 802.3** 是第一个IEEE的以太网标准。
	- DIX Ethernet V2 标准与 IEEE的802.3标准只有很小的差别，因此可以将802.3局域网简称为“以太网”。
	- 严格说来，“以太网”因当时符合DIX Ethernet V2标准的局域网
- 数据链路层的两个子层
	- 为了使数据链路层能更好地适应多种局域网标准，IEEE 802委员会就将局域网的数据链路层拆成两个子层
		- **逻辑链路控制LLC子层**
		- **媒体接入控制MAC子层**
	- 与接入到传输媒体有关的内容都翻在MAC子层，而LLC子层则与传输媒体无关
	- **不管采用何种协议的局域网，对LLC子层来说都是透明的。**
	- 一般不考虑LLC子层
- 适配器的作用
	- 网络接口板又称为**通信适配器**或**网络接口卡NIC**或**网卡**
	- 适配器的重要功能
		- **进行串行**/**并行转换**
		- **对数据进行缓存**
		- **在计算机的操作系统安装设备驱动程序**
		- **实现以太网协议**
##### CSMA/CD协议
- 最初的以太网是将许多计算机都连接到一根总线上。当初认为这样的连接方法既简单有可靠，因为总线上没有有源器件。
- ![VlotHO.png](https://s2.ax1x.com/2019/05/31/VlotHO.png)
- 以太网用广播方式发送
	- 总线上的每一个工作的计算机都能检测到B发送的数据信号
	- 由于只有计算机D的地址与数据帧首部写入的地址一致，因此只有D才接收这个数据帧。
	- 其他所有计算机A,C,E都检测到不是发送给他们的数据帧，因此就丢弃这个数据帧。
	- 在具有广播特性的总线上实现了一对一通信
- **以太网采取了两种重要的措施**
	- 采用了较为灵活的**无连接的工作方式**
		- 不必建立连接既可以直接发送数据
		- 对发送的数据帧不进行编号，也不要求对方发挥确认
		- **这样做的理由是局域网信道的质量很好，因信道质量产生差错的概率是很小的**
		- **以太网提供的服务是不可靠的交付，即尽最大努力的交付**
		- 当目的站收到有差错的数据帧时就丢弃此帧，其他什么都不做。**差错的纠正由高层来决定**
		- 如果高层发现丢失了一些数据进行重传，但以太网并不知道这是一个重传的帧，而是当作一个新的数据帧来发送
	- 以太网发送的数据都**使用曼彻斯特编码**
		- 曼彻斯特编码的缺点时：它所占的频带宽度比原始的基带信号增加了一倍
- CSMA/CD含义：**载波监听多点接入/碰撞检测**
	- **多点接入**表示许多计算机以多点接入的方式连接在一根总线上
	- **载波监听**是指每一特站再发送数据之前先要检测以下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞
	- 总线上并没有什么载波，因此**载波监听就是用电子技术检测总线上有没有其他计算机发送的数据信号**
- 碰撞检测
	- **碰撞检测**就是计算机边发送数据边检测信道上的信号电压大小。
	- 当几个站同时在总线上发送数据时，总线上的信号电压摆动值会增大（互相叠加）
	- 当一个站检测到的信号电压摆动超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。
	- **所谓碰撞就是发生了冲突。因此碰撞检测也成为冲突检测**
	- **每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要 立即停止发送 ，免得继续浪费网络资源，然后 等待一段随机时间 后再次发送**
- 为什么要进行碰撞检测？
	- 由于电磁波在总线上的传播速率是有限的，当某个站监听到总线是空闲是，也可能总线并非真正是空闲的。
	- A向B发出的信息，要经过一定的时间后才能传到B。
	- B若在A发送的信息到达B之前发送自己的帧，则必然要在某个时间和A发送的帧发生碰撞。导致两个帧都变得无用
	- **所以需要在发送期间进行碰撞检测，以检测冲突**
	- 信号传播时延对载波监听的影响
	- ![V1oz6I.png](https://s2.ax1x.com/2019/06/01/V1oz6I.png)
- CSMA/CD 的重要特性	
	- 使用CSMA/CD协议的以太网不能进行全双工通信而**只能进行双向交替通信（半双工通信）**
	- 每个站再发送数据之后的一小段时间内，存在着在遭遇碰撞的可能性。
	- 这种**发送的不确定性**使整个以太网的平均通信量远小于以太网的最高数据率
- 争用期
	- 最先发送数据帧的站，再发送数据帧后**至多**经过**两倍的端到端往返时延**就可知道发送的数据帧是否遭受了碰撞。
	- 以太网的2倍端到端往返时延成为**争用期**，或**碰撞窗口**
	- **经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞**
- 二进制指数类型避退算法
	- 发生碰撞的站在停止发送数据后，要推迟一个**随机时间**才能发送数据
		- 基本退避时间取为争用期2t
		- 从整数集合[0, 1, … , (2的k次幂 - 1)]中**随机**的取出一个数，记为r。重传所需的时延就是r倍的基本时间。
		- 参数k按下面的公式计算
			- k = MIN[重传次数，10]
		- 当k <= 10 时，参数k等于重传次数。
		- 当重传次数达到16时仍不能成功时即丢弃该帧，并向高层报告。
- 争用期的长度
	- 10Mbit/s以太网取51.2us为争用期的长度。
	- 对于10Mbit/s以太网，在争用期内可发送512bit，即64字节
	- **这意味着，以太网在发送数据时，若前64字节没有发生冲突，则后续的数据就不会发生冲突**。
- 最短有效帧长
	- 如果发生冲突，就一定是在发送的前64字节内。
	- 由于一检测到冲突就停止发送，这是已经发送出去的数据一定小于64字节。
	- 以太网规定了最短有效帧长为64字节，凡是长度小于64字节的帧都是由于冲突而异常终止的**无效帧**
- 强化碰撞
	- 当发送数据的站一旦发现发生了碰撞时：
		- 立即停止发送数据
		- 再继续发送若干比特的**人为干扰信号**，以便让所有用户都知道现在已经发生了碰撞
- **CSMA/CD协议的要点**
	- **准备发送**。但在发送前必须检测信道。
	- **检测信道**。若检测到信道忙，则应不停地检测，一直等待信道转为空闲。若检测到信道空闲，并在96**比特时间**内信道保持空闲（保证了帧间最小间隔），就发送这个帧。
	- **检查碰撞**。再发送过程中仍不停地检测信道。即网络适配器要边发送边监听。这里只有两种可能型
		- 发送成功：在争用期内一直检测到碰撞。这个帧肯定能够发送成功，发送后什么都不做。
		- 发送失败：在争用期内检测到碰撞。这是立即停止发送数据，并按规定发送人为干扰信号。适配器接着就执行指数退避算法，等待r倍512**比特时间**后，继续检测信道。但若16此仍不能成功，则停止传送而向上报错。
##### 使用集线器的星形拓扑
- 传统以太网最初使用粗同轴电缆，后来演进到使用比较便宜的细同轴电缆，最后发展为使用更便宜和灵活的双绞线。
- 采用双绞线的以太网采用星形拓扑。在星形的中心则增加了一种可靠性非常高的设备，叫做**集线器hub**
- **集线器的一些特点**
	- 集线器是使用电子器件来模拟实际电缆线工作，因此整个系统仍像一个传统以太网那样运行。
	- **使用集线器的以太网在逻辑上仍是一个总线网，各工作站使用的还是CSMA/CD协议，并共享逻辑上的总线**
	- 集线器很想一个多接口的转发器，**工作在物理层**
	- 集线器采用了专门的芯片，进行自适应串音回拨抵消，减少了近端串音。
##### 以太网的信道利用率
- 多个站在以太网上同时工作就可能会发生碰撞。
- 当发生碰撞时，信道资源实际上是被浪费了。因此，当扣除碰撞所造成的信道损失后，**以太网总的信道利用率并不能达到100%**
- 假设t是以太网单程端到端传播时延。则争用期时间长度为2t，即端到端传播时延的两倍。检测到碰撞后不发送敢逃信号
- 设帧长度为L（bit），数据发送速率为C（bit/s），则帧的发送时间为t0 = L/S（s）。
- 一个站再发送帧时出现了碰撞。经过一个争用期2t后，可能又出现了碰撞。这样经过若干个争用期后，一个站发送成功了。假定发送帧需要的时间为t0。
- ![V1blAf.png](https://s2.ax1x.com/2019/06/01/V1blAf.png)
- 注意到，成功发送一个帧需要占用信道的时间时**t0 + t**，比这个帧的发送时间要多一个单程端到端时延t。这是因为当一个站发送完最后一个bit时，这个bit还要再以太网上传播。
- 在最极端的情况下，发送站在传出媒体的一点，而比特在媒体上传输到另一端所需的时间是t。
- 参数a（阿尔法）与利用率
	- 要提高以太网的信道利用率，就必须减小t与t0之比。
	- 在以太网中定义了参数a，他是以太网单程端到端时延t与帧的发送时间t0之比。
	-           a = t / t0
	- a -> 0 ，表示一发生碰撞就立即可以检测出来，并立即停止发送，因而信道利用率很高。
	- a越大，表明争用期所占用的比例增大，没发生一次碰撞就浪费许多信道资源，使得信道利用率明显降低。
- 对以太网参数a的要求
	- 为提高利用率，以太网参数a的值应当尽可能地小些。
	- **对以太网a参数的要求是**
		- 当数据率一定时，以太网的联想的长度收到限制，否者t的数值会太大。
		- 以太网的帧长不能太短，否了t0的值会太小，使a的值太大。
- 信道利用率的最大值Smax
	- 在理想化的情况下，以太网上的各站发送数据都不会产生碰撞（这显然已经不是SCMA/CD，而是需要使用一种特殊的调度方法），即总线一旦空闲就有某一个站立刻发送数据。
	- 发送一帧战功的线路的时间使t0 + t，而帧本身的发送时间是t0.于是我们可以计算出理想情况下的极限信道利用率Smax为：
	-           Smax = t0 / （t0 + t） = 1 / （1 + a）
	- 只有参数a远小于1才能得到尽可能高的极限信道利用率。
	- 据统计，当以太网的利用率达到30%时就已经处于重载的情况了。很多的网络容量被网上的碰撞消耗掉了。
##### 以太网的MAC层
- MAC层的硬件地址
	- 在局域网中，**硬件地址**又称为**物理地址**，或**MAC地址**.
	- 802标准所说的地址严格上因当是每一个站的**“名字”或标识符**
	- 但鉴于大家都早已习惯了将这种48位的名字成为地址。所以采用这种叫法，但是并不太严格。
	- 注意，如果连接在局域网上的主机或路由器安装有多个适配器，那么这样的住居或路由器就有多个“地址”。准确的说，这种48位“地址”应该是莫一个接口的标识符。
- 48位的MAC地址
	- IEEE 802 标准规定MAC地址字段可采用6字节（48位）或2字节（16位）这两种中的一种
	- IEEE的注册管理机构RA负责向厂家分配地址字段6个自建的前三个字节（即**高24位**），称为**组织唯一标识符**。
	- 地址字段6个字节中的后三个字节（低24位）由厂家自行指派，称为**扩展地址唯一标识符**，**必须保证生产出的适配器没有重复地址。**
	- ![V1LPJO.png](https://s2.ax1x.com/2019/06/01/V1LPJO.png)
	- 一个地址块可以生成2的24次方个不同的地址，这种48位地址称为MAC-48，他的通用名是EUI-48
	- 生产适配器时，6字节的MAC地址已被固化在适配器的ROM，因此，MAC地址也叫做**硬件地址**或**物理地址**。
	- MAC地址实际上就是适配器地址或适配器标识符EUI-48
- 单站地址，组地址，广播地址
	- IEEE规定地址字段的第一字节的最低为位I/G位，
	- 当**I/G位 = 0**时，地址字段表示一个**单站地址**
	- 当**I/G位 = 1**时，表示**组地址**，用来进行多播。此时，IEEE只分配地址字段前三个字节的23位
	- 当I/G位分别位0和1时，一个地址块可分别生成2的23次方个组地址。
	- 所有48位都为1时，位广播地址。只能作为目的地址使用。
- 全球管理与本地管理
	- IEEE把地址字段第一字节的最低第2位规定为G/L位，表示GLOBAL/LOCAL
	- 当**G/L位 = 0**时，是**全球管理**（保证在全球没有相同的地址），厂商向IEEE购买的OUI都属于全球管理。
	- 当**G/L位 = 1**时，时**本地管理**，这时用户可任意分配网络上的地址。
- 适配器检查MAC地址
	- 适配器从网络上没收到一个MAC帧就首先用硬件检查MAC帧中的MAC地址。
		- 如果是**发往本站的帧**则收下，然后进行其他的处理
		- 如果不是就将此帧丢弃，不再进行其他的处理。
	- 发往本站的帧包括以下三种帧
		- 单播帧
		- 广播帧
		- 多播帧
	- **所有适配器都至少能够识别单播地址和广播地址**
	- 有的适配器可用编程方法识别多播地址。
	- **只有目的地址才能使用广播地址和多播地址**
	- 以**混杂方式**工作的以太网适配器只要“听到”有帧在以太网上传输就都接收下来。
- MAC帧的格式
	- 常用的以太网MAC 帧格式有两种标准
		- DIX Ethernet V2 标准
		- IEEE 的 802.3 标准
	- 最常用的MAC帧是以太网的V2格式
		- ![V1jQfK.png](https://s2.ax1x.com/2019/06/01/V1jQfK.png)
		- 类型字段用来标志上一层使用的是什么协议，以便把收到的MAC帧的数据交给上一层的这个协议。
		- 数据字段的正式名称是MAC客户数据字段
			- 最小长度64字节 - 18字节的首部和尾部 = 数据字段的最小长度（46字节）
			- 当数据字段的长度小于64字节时，应在数据字段的后面加入整数字节的填充字段，以保证以太网的MAC帧长不小于64字节。
		- 为了达到比特同步，在传输媒体上实际传送的要比MAC帧还多八个字节
		- 无效的MAC帧
			- 数据字段的长度与长度字段的的值不一致；
			- 帧的长度不是整数个字节；
			- 用收到的帧检验序列FCS查出有差错；
			- 数据字段的长度不再64到1500之间
			- 有效的MAC帧长度位64到1581字节之间
			- **对于检查出无效的MAC帧就简单的丢弃，以太网不负责重传丢弃的帧**
	- IEEE 802.3 MAC帧格式
		- 与以太网V2 MAC 帧格式相似，区别在与以下：
		- IEEE 802.3规定的MAC帧的第三个字段是**“长度/类型”**
			- 当这个字段的值大于0x0600（1536）时，就表示类型。
			- 小于这个值则表示长度。
	- **现市场上流行的都是以太网V2的MAC帧，但大家也常常把它称为IEEE 802.3标准的MAC帧。**
- 帧的最小间隔
	- 帧间最小间隔位9.6us，相当于96bit发送的时间
	- 一个站在检测到总线开始空闲后，还要等待9.6us后才能再次发送数据
	- 这样做是为了使刚刚收到数据帧的站的接收缓存来得及清理，做好接受下一帧的准备。
### 扩展的以太网
##### 在物理层扩展的以太网
- 使用光纤扩展
	- 主机使用光纤（通常是一堆光纤）和一堆光纤调制解调器连接到集线器。
	- 很容易使主机和几公里外的集线器相连接。
	- ![V1xkqJ.png](https://s2.ax1x.com/2019/06/01/V1xkqJ.png)
- 使用集线器扩展
	- 使用多个集线器可练成更大的，多级星形节构的以太网
	- ![V1xlse.png](https://s2.ax1x.com/2019/06/01/V1xlse.png)
	- 优点：
		- 使原来属于不同碰撞域的以太网上的计算机能够进行跨碰撞域的通信
		- 扩大了以太网覆盖的地理范围
	- 缺点：
		- 碰撞域增大了，但总的吞吐量并未提高
		- 如果不同的碰撞域使用不同的数据率，那么就不能用集线器将他们互连起来。
##### 在数据链路层扩展的以太网
- 扩展以太网更常用的方法是在数据链路层进行。
- 早期使用**网桥**，现在使用以太网**交换机**
	- 网桥工作在数据链路层
	- 他根据MAC帧的目的地址对收到的帧进行转发和过滤
	- 当网桥收到一个帧时，并不是向所有的接口转发此帧，而是先检查此帧的目的MAC地址，然后在确定该帧转发到哪一个接口，或把他丢弃。
	- 1990年问世的**交换式集线器**可明显的提高以太网的性能。
	- **交换式集线器**长称为**以太网交换机**或**第二层交换机**，强调这种交换机工作在数据链路层。
- 以太网交换机的特点
	- 以太网交换机实质上就是一个**多接口的网桥**。通常有十几个或更多的接口
	- 每个接口都直接与一个澹台主机或另一个以太网交换机相连，并且一般都**工作在全双工方式**
	- 以太网交换机具有**并行性**：能够同时连通多对接口，使多对主机能同时通信
	- **相互通信的主机都是独占传输媒体，无碰撞地传输数据**
- 以太网交换机的优点
	- 用户独享带宽，增加了总容量
		- 对于普通10Mbit/s的共享式以太网，若共有N给个用户，则每个用户占有的平均带宽只有总带宽的N分之一。
		- 使用以太网交换机时，虽然在每个接口道主机的带宽还是10Mbit/s，但由于一个用户在通信时是独占而不是和其他网络用户共享传输媒体的带宽，因此对于拥有N个接口的交换机的总容量位N*10 Mbit/s。
	- 从共享总线以太网转到交换式以太网时，所有接入设备的软件和硬件，适配器等都不需要任何的改动。
	- 以太网交换机一般都具有多种昂速率的接口，方便了各种不同情况的用户
- 以太网交换机的交换方式
	- **存储转发方式**
		- 把整个数据帧先缓存后在进行处理
	- **直通方式**
		- 接收数据帧的同时就**立即按数据帧的目的MAC地址决定该帧的转发接口，因而提高了帧的转发速度**。
		- **缺点**是他不检查差错就直接将帧转发出去，因此有可能也将一下无效的帧转发给其他的站
	- 在某些情况下，仍需要采用基于软件的存储，转发方式进行交换，例如，当需要进行线路速率匹配，协议转换或差错检测时。
- 以太网交换机的自学习功能
	- 以太网交换机运行自学习算法啊自动维护交换表
	- 开始时以太网交换机里面的交换表是空的。
	- **按照以下自学习算法处理收到的帧和建立交换表**
		- A先向B发送一帧，从接口1进入到交换机
		- 交换机收到帧后，先查找交换表，没有查到应从哪个接口转发这个帧
		- 交换机把这个帧的源地址A和接口1写入交换表中，冰箱除接口1以外的所有接口广播这个帧。
		- C和D将丢弃这个帧，因为目的地址不对。只有B才手下这个目的地址正确的帧。这也称为**过滤**
		- 从新写入交换表的项目（A，1）可以看出，只要其目的地址是A，就应当把收到的帧从接口1转发出去。
		- B通过接口3向A发送一帧
		- 交换机查找交换表，发现教皇i奥中的MAC地址有A。表明要发送给A的帧应从接口1转发，于是就把这个帧传送到接口1转发个A。显然，现在已经没有必要在广播收到的帧。
		- 交换表这是新增加的项目（B，3），表明今后如有发送给B的帧，就应从接口3转发出去。
		- 经过一点时间后，只要主机C和D先其他主机发送帧，以太网交换机中的交换表就会把转发到C或D应当经过的接口号2或4写入到交换表中
		- ![V3PHFH.png](https://s2.ax1x.com/2019/06/01/V3PHFH.png)
	- 以太网交换机的这种自学习方法使得以太网交换机能够即插即用，不必进行人工培植，因此非常方便
- 交换机使用了生成树协议
	- **增加冗余链路时，自学习的过程就可能导致额以太网帧在网络的某个环路中无限制地兜圈子。**
	- ![V8Yvsx.png](https://s2.ax1x.com/2019/06/02/V8Yvsx.png)
	- IEEE 802.1D制定了一个**生成树协议STP**，其要点是
		- **不改变网络的实际拓扑，但在逻辑上则切断某些链路，使得从一台主机到所有其他主机的路径是无环路的树状结构，从而消除了兜圈子的现象**
##### 虚拟局域网
- 利用以太网交换机可以很方便地实现虚拟局域网VLAN
- 虚拟局域网是VLAN是有一些局域网网段构成的与物理位置无关的逻辑组，而这些网段具有某些共同的需求。每一个VLAN的帧都有一个明确的标识符。指明发送这个帧的计算机是属于哪一个VLAN。
- **虚拟局域网其实只是局域网给用户提供的一种服务，而并不是一种新型局域网**
- 由于虚拟局域网是用户和网络资源的逻辑结合，因此可按照需要将有关设备和资源非常方便地重新组合，使用户从不同的服务器或数据库中存取所需资源
- ![VGE9bt.png](https://s2.ax1x.com/2019/06/02/VGE9bt.png)
- 当B1向VLAN2工作组内成员发送数据时，工作站B2和B3将会收到广播的信息。
- B1发送数据时，工作站A1,A2和C1，C2都不会收到B1发送的广播信息
- **虚拟局域网限制了接收广播信息的工作站数，使得网络不会应传播过多的信息（广播风暴）而引起性能恶化**
- 虚拟局域网使用的以太网帧格式
	- IEEE批准了802.3ac标准，该标准定义了以太网的帧格式的扩展，以支持虚拟局域网。
	- 虚拟局域网协议允许在以太网的帧格式中插入一个4字节的标识符称为**VLAN标记**用来知名发送该帧的计算机属于哪一个虚拟局域网。
	- 插入VLAN标记得出的帧称为**802.1Q帧**或**带标记的以太网帧**
### 高速以太网
##### 100BASE-T以太网
- 速率达到或超过100Mbit/s的以太网称为高速以太网
- 100BASE-T以太网在双绞线上传送100Mbit/s基带信号的星形拓扑以太网仍使用802.3的CSMA/CD协议。
- 100BASE-T以太网又称为**快速以太网**
- 特点
	- 可在全双工方式下工作而无冲突发生。**在全双工下工作时，不使用CSMA/CD协议。**
	- MAC帧格式仍然是802.3标准规定的。
	- **保持最短帧长不变，但将一个网段的最大电缆长度减小到100m**
	- 帧时间间隔从原来的9.6us变为现在的0.96us
##### 吉比特以太网
- 允许在1Gbit/s下以全双工和半双工两种方式工作。
- 使用IEEE802.3协议规定的帧格式
- **再半双工方式下使用CSMA/CD协议，全双工下不使用CSMA/CD协议**
- **吉比特以太网可用作现有网络的主干网，也可在高带宽的应用场合中**
- 为保持64字节最小帧长度，以及100m的网段的最大长度，吉比特以太网增加了两个功能
	- **载波延伸**
		- 使用最短帧长仍为64字节，同时将争用时间增大为512字节。
		- 凡发送的MAC帧成不足512字节时，就用一些特殊的字符岸填充在帧的后面，使MAC帧的发送长度增大到512字节，接收端在收到以太网的MAC帧后，要将所填充的特殊字符删除后才想高层交付。
		- ![VGmMy4.png](https://s2.ax1x.com/2019/06/02/VGmMy4.png)
	- **分组突发**
		- 当很多短帧要发送时，第一个短帧要采用载波延伸方法进行填充，随后的一些短帧可一个接一个发送，只需留有必要的帧最小时间间隔即可。这样就形成了可遗传分组的突发，直到达到1500字节或稍多一些为止。
		- ![VGmR1S.png](https://s2.ax1x.com/2019/06/02/VGmR1S.png)
- **当吉比特以太网在全双工方式时，不适用载波延伸和分组突发**
##### 10吉比特以太网和更快的以太网
- 特点
	- 与10Mbit/s，100Mbit/s和1Gbit/s以太网的帧格式完全相同
	- 保留了802.3标准规定的以太网最小和最大帧长，便于升级。
	- 不再使用铜线而只使用光纤作为传输媒体
	- **只在全双工方式工作**，因此没有征用问题，也不适用CSMA/CD协议。
- 端到端的以太网传输
	- 以太网的工作范围已经从局域网（校园网，企业网）扩大到城域网和广域网，从而**实现了端到端的以太网传输**
	- 好处有
		- 技术成熟
		- 互操作性好
		- 在广域网中使用以太网时价格便宜
		- 采用统一的以太网帧格式，简化了操作和管理。
- 以太网从10Mbit/s到100Mbit/s的演进证明了以太网是
	- 可扩展的
	- 灵活的
	- 易于安装
	- 稳健性好
##### 使用以太网进行宽带接入
- 以太网宽带接入具有以下的**特点**
	- 可以提供**双向**的宽带通信
	- 可以根据用户对宽带的需求灵活的进行宽带升级
	- 可以实现端到端的以太网传输，中间**不需要在进行帧格式的转换**。这就提高了数据的传输效率且降低了传输成本。
	- **但是不支持用户身份鉴别**